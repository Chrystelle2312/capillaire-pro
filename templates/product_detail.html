<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ product.name }} - Capillaire Pro</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        .product-container { display: flex; gap: 40px; margin-bottom: 40px; }
        .product-image img { max-width: 100%; width: 300px; border-radius: 8px; object-fit: contain; }
        .product-info { flex: 1; }
        h1 { color: #333; }
        .price { font-size: 1.5em; color: #d22c69; font-weight: bold; }
        .stock { color: #666; margin-bottom: 20px; }
        .stock.out { color: red; }
        .btn { padding: 10px 20px; background-color: #d22c69; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; }
        .btn:hover { background-color: #c82363; }
        
        /* Section Avis */
        .reviews-section { border-top: 1px solid #ddd; padding-top: 20px; }
        .review { background: #f9f9f9; padding: 15px; margin-bottom: 15px; border-radius: 5px; }
        .stars { color: #f0ad4e; }
        
        /* Formulaire */
        textarea { width: 100%; height: 80px; margin-top: 10px; padding: 8px; }
        select { padding: 5px; }
        .back-link { display: block; margin-bottom: 20px; text-decoration: none; color: #666; }
    </style>
</head>
<body>
    <a href="/" class="back-link">← Retour à la boutique</a>

    <div class="product-container">
        <div class="product-image">
            <img src="/static/images/{{ product.image }}" alt="{{ product.name }}">
        </div>
        <div class="product-info">
            <h1>{{ product.name }}</h1>
            <p class="price">{{ product.price }} €</p>
            
            {% if product.stock > 0 %}
                <p class="stock">En stock : {{ product.stock }} unités</p>
                <div style="display: flex; gap: 10px;">
                    <form method="post" action="/create-checkout-session">
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <button type="submit" class="btn" style="background-color: #28a745;">Acheter</button>
                    </form>
                    <form action="/add-to-cart" method="post">
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <button type="submit" class="btn">Ajouter au panier</button>
                    </form>
                </div>
            {% else %}
                <p class="stock out">Rupture de stock</p>
            {% endif %}
            
            <p style="margin-top: 20px;">{{ product.message }}</p>
        </div>
    </div>

    <div class="reviews-section">
        <h2>Avis clients</h2>
        
        {% if user %}
            <div style="margin-bottom: 30px; background: #fff; border: 1px solid #eee; padding: 15px;">
                <h3>Laisser un avis</h3>
                <form action="/product/{{ product.id }}/review" method="post">
                    <label>Note :</label>
                    <select name="rating" required>
                        <option value="5">⭐⭐⭐⭐⭐ (5/5)</option>
                        <option value="4">⭐⭐⭐⭐ (4/5)</option>
                        <option value="3">⭐⭐⭐ (3/5)</option>
                        <option value="2">⭐⭐ (2/5)</option>
                        <option value="1">⭐ (1/5)</option>
                    </select>
                    <br>
                    <textarea name="comment" placeholder="Votre commentaire..." required></textarea>
                    <br><br>
                    <button type="submit" class="btn" style="background-color: #333;">Publier l'avis</button>
                </form>
            </div>
        {% else %}
            <p><a href="/login">Connectez-vous</a> pour laisser un avis.</p>
        {% endif %}

        {% if reviews %}
            {% for review in reviews %}
                <div class="review">
                    <strong>{{ review.user.username }}</strong> 
                    <span class="stars">
                        {% if review.rating == 1 %}⭐{% endif %}
                        {% if review.rating == 2 %}⭐⭐{% endif %}
                        {% if review.rating == 3 %}⭐⭐⭐{% endif %}
                        {% if review.rating == 4 %}⭐⭐⭐⭐{% endif %}
                        {% if review.rating == 5 %}⭐⭐⭐⭐⭐{% endif %}
                    </span>
                    <p>{{ review.comment }}</p>
                </div>
            {% endfor %}
        {% else %}
            <p>Aucun avis pour le moment.</p>
        {% endif %}
    </div>
</body>
</html>